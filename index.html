<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla Ecosystem Live Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .data-card {
            background-color: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 0.75rem;
            padding: 1.5rem;
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #ffffff;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-3xl bg-gray-800 rounded-xl shadow-2xl p-6 sm:p-8 space-y-6">
        <!-- Header -->
        <div class="flex justify-between items-center border-b border-gray-700 pb-4">
            <div>
                <h1 class="text-2xl sm:text-3xl font-bold text-cyan-400">Tesla Energy Flow</h1>
                <p id="logic-status" class="text-gray-400 text-lg">Initializing live data feed...</p>
            </div>
             <div id="status-indicator" class="w-4 h-4 rounded-full bg-green-500" title="System Online"></div>
        </div>

        <!-- Main Data Display -->
        <div id="data-container" class="space-y-6">
            <!-- This will be populated by the script -->
        </div>
        
        <!-- Footer with refresh info -->
        <div class="text-center text-gray-500 pt-4 border-t border-gray-700">
            <p>Data automatically refreshes every 10 seconds.</p>
            <p id="last-updated" class="text-sm mt-1">&nbsp;</p>
        </div>
    </div>

    <script>
        const logicStatusEl = document.getElementById('logic-status');
        const statusIndicatorEl = document.getElementById('status-indicator');
        const dataContainer = document.getElementById('data-container');
        const lastUpdatedEl = document.getElementById('last-updated');
        
        // Base data object. We will start with this and simulate changes.
        let liveData = {
            "powerwall": {
                "solar_production_kw": 4.5,
                "home_usage_kw": 0.8,
                "powerwall_level_percent": 99.5
            },
            "vehicle": {
                "status": "Online",
                "plugged_in": true,
                "charging_state": "Charging",
                "battery_level_percent": 65
            },
            "logic": {
                "status": "Charging from excess solar..."
            }
        };

        // This function simulates realistic data changes for the demo.
        function simulateDataUpdate() {
            // Simulate small fluctuations in power data
            liveData.powerwall.solar_production_kw = Math.max(0, (liveData.powerwall.solar_production_kw + (Math.random() - 0.48) * 0.5)).toFixed(1);
            liveData.powerwall.home_usage_kw = Math.max(0.3, (liveData.powerwall.home_usage_kw + (Math.random() - 0.5) * 0.2)).toFixed(1);
            
            // Simulate vehicle charging slowly
            if (liveData.vehicle.battery_level_percent < 99.8) {
                liveData.vehicle.battery_level_percent += 0.1;
            }
            liveData.vehicle.battery_level_percent = parseFloat(liveData.vehicle.battery_level_percent.toFixed(1));

            // Cycle through logic statuses
            const statuses = ["Charging from excess solar...", "Optimizing energy flow...", "Grid export maximized.", "Powerwall supporting home."];
            if (Math.random() > 0.8) { // Change status occasionally
               liveData.logic.status = statuses[Math.floor(Math.random() * statuses.length)];
            }
        }

        function renderData(data) {
            const pw = data.powerwall;
            const vh = data.vehicle;
            
            // Recalculate grid power dynamically for rendering
            const gridPower = (pw.solar_production_kw - pw.home_usage_kw).toFixed(1);
            let gridStatus;
            if (gridPower > 0) {
                gridStatus = `Exporting ${gridPower} kW`;
            } else {
                gridStatus = `Importing ${Math.abs(gridPower).toFixed(1)} kW`;
            }

            dataContainer.innerHTML = `
                <!-- Powerwall Section -->
                <div class="data-card space-y-4">
                    <h2 class="text-xl font-bold text-gray-300 flex items-center"><span class="text-2xl mr-3">ðŸ”‹</span>Powerwall Status</h2>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
                        <div>
                            <p class="text-sm text-gray-400">Battery Level</p>
                            <p class="text-2xl font-semibold text-green-400">${pw.powerwall_level_percent}%</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Solar</p>
                            <p class="text-2xl font-semibold text-yellow-400">${pw.solar_production_kw} kW</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Home Use</p>
                            <p class="text-2xl font-semibold text-blue-400">${pw.home_usage_kw} kW</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Grid</p>
                            <p class="text-2xl font-semibold ${gridPower > 0 ? 'text-purple-400' : 'text-red-400'}">${gridStatus}</p>
                        </div>
                    </div>
                </div>

                <!-- Vehicle Section -->
                <div class="data-card space-y-4">
                    <h2 class="text-xl font-bold text-gray-300 flex items-center"><span class="text-2xl mr-3">ðŸš—</span>Vehicle Charging</h2>
                     <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 text-center">
                        <div>
                            <p class="text-sm text-gray-400">Status</p>
                            <p class="text-xl font-semibold">${vh.status}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">State</p>
                            <p class="text-xl font-semibold text-cyan-400">${vh.charging_state}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Battery Level</p>
                            <p class="text-xl font-semibold text-green-400">${vh.battery_level_percent}%</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Main function to update and render the display
        function updateDisplay() {
            try {
                simulateDataUpdate(); // Create new "live" data
                renderData(liveData); // Render it to the screen

                // Update header and footer text with current info
                logicStatusEl.textContent = liveData.logic.status;
                lastUpdatedEl.textContent = `Last updated at ${new Date().toLocaleTimeString()}`;

            } catch (error) {
                console.error("Error updating display:", error);
                dataContainer.innerHTML = `<div class="text-center text-red-400 bg-red-900/50 p-4 rounded-lg">
                                            <strong>Error:</strong> An internal error occurred while rendering data.
                                           </div>`;
            }
        }

        // Initial call to populate the page
        updateDisplay();

        // Refresh every 10 seconds
        setInterval(updateDisplay, 10000);
    </script>

</body>
</html>

